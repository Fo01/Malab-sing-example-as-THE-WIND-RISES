clear;
clc;
fs=12000;       
%每一拍音符的时间长度，这里只是比例就可以了，具体的可以再调整
leng=[1,1,1,1,2,1,1,2,2,4,1,1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,1,1,2,1,1,2,2,4,1,1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,1,1,2,1,1,2,2,4,1,1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,1,1,2,1,1,2,2,4,4,4,4,4,3,1,3,1,2,2,2,1,1,3,1,3,1,1,1,1,1,4,3,1,3,1,2,2,2,1,1,3,1,2,1,1,4,4,3,1,3,1,2,2,2,1,1,3,1,2,1,1,4,1,1,1,1,4,1,1,1,1,3,1,1,1,1,1,4,4,2,2,2,2,2,1,1,3,1,2,1,1,4,2,1,1,3,1,1,1,1,1,2,2,2,1,1,1,1,1,1,2,1,1,2,1,1,4,4,2,2,2,2,2,1,1,3,1,2,1,1,4,2,1,1,3,1,1,1,1,1,2,2,2,1,1,2,2,2,1,1,2,1,1,4,4,4,2,2,2,1,1,2,1,1,2,1,1,2,1,1,2,1,1,2,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,1,2,1,3,4,1,1,1,1,1,3,2,2,2,1,1,2,1,1,2,1,1,2,2,2,1,1,2,1,1,2,1,1,1,3,2,1,1,1,3,1,1,2,1,3,4,4,4,1,3,2,1,1,2,1,2,2,1,2,2,2,4,4,4,4]; %节拍 持续时间
%与原曲听了之后做一个手动的调整
leng=leng/5;
%是否连音，0表示不连1表示连
lian=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,1,0,1,1,0,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,0,1,1,0,1,0,1,0,0,0,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,1,0,0,0,0,0,1,0,1,0,1,0,1,0,0,1,1,1,0];   %是否连着
%音调，具体含义看24行
song=[21,1,2,3,17,5,3,16,19,2,21,1,2,3,16,5,3,2,3,1,2,21,1,19,21,1,2,3,17,5,3,16,19,2,21,1,2,3,16,5,3,2,3,1,2,21,1,19,21,1,2,3,17,5,3,16,19,2,21,1,2,3,16,5,3,2,3,1,2,21,1,19,21,1,2,3,17,5,3,16,19,2,2,2,1,1,2,1,2,1,2,3,5,3,2,2,1,2,1,2,3,2,1,19,2,1,2,1,2,3,5,3,2,2,3,2,1,2,2,2,2,1,2,1,2,3,5,3,2,2,3,2,1,20,20,3,2,1,2,1,3,2,1,2,1,19,3,2,1,2,1,1,1,2,3,1,6,5,6,6,1,7,6,7,7,7,6,7,7,3,8,9,8,7,6,5,6,5,6,6,5,6,5,6,5,2,2,5,3,3,3,1,2,3,1,6,5,6,6,1,7,6,7,7,7,6,7,7,3,8,9,8,7,6,5,6,10,10,10,5,6,10,10,10,5,6,6,6,6,8,9,10,13,12,12,13,12,12,13,12,12,9,10,10,13,12,12,13,12,12,13,12,12,9,10,9,8,6,6,8,8,9,8,6,6,8,10,10,11,10,9,10,9,8,9,10,13,12,12,13,12,12,13,12,12,10,10,13,12,12,13,12,12,13,12,12,10,9,8,6,6,10,9,8,6,6,8,8,8,8,6,10,9,8,6,6,10,9,9,8,6,6,8,8,8,8,8]; %do re mi
x=[];
%与实际歌曲对比后调整音长

for i=1:length(song)
    x=[x,wave(song(i),leng(i),lian(i))];
end
%plot(x)
sound(x,fs);

function y=wave(tone,rhythm,flag)
    fs=12000;
    %C大调
    freqs=[523,587,659,698,784,880,988,1047,1175,1319,1397,1568,1760,1967,262,294,330,349,392,440,494,0];
    %freqs=[370,415,466,523,554,622,698,740,830,932,1046,1108,1244,1396,0,207,233,262,277,311,349]; 
    %freqs=[740,830,932,1046,1108,1244,1396,370,415,466,523,554,622,698,0,207,233,262,277,311,349]; 
    %频率 1-7正常8-14高8度，15-21低8度 do re mi...... 22休止符
    x=linspace(0,2*pi*rhythm,floor(fs*rhythm));
    if flag==0
        y=sin(freqs(tone)*x).*exp(-x); %采用指数做衰减函数，衰减函数更多会改变音色
        %y=sin(freqs(tone)*x).*(1-x/(rhythm*pi*2)); %线性衰减函数，原视频是线性衰减
    else
        y=sin(freqs(tone)*x);
    end
    
end
